from game_logic.test_tarot_objects import Card, Client, Reader, draw_cards

@metadata
  title: The Reader's Journey
  author: Kate & Clicky
  version: 1.0.0
  story_id: test_nicegui_game
  description: Begin your journey as a tarot reader

@start VarInit

:: VarInit
<<py
elena = Client("Elena Hart", 28)
elena.flavor_text = "Trust issues, seeking clarity"
marcus = Client("Marcus Webb", 32)
marcus.flavor_text = "Career crossroads, needs direction"
aria = Client("Aria Chen", 25)
aria.flavor_text = "Lost love, searching for closure"
# Special Clients
nyx = Client("Nyx", 25)
nyx.flavor_text = "???"
>>
-> Prologue

:: Prologue
~ reader = Reader("You")
~ completed_sessions = 0
~ total_earnings = 0

**The Mysterious Package**

You find a worn black leather book on your doorstep. No return address. Inside, ornate handwriting lists names:

*Elena Hart - Trust Issues*
*Marcus Webb - Career Crossroads*
*Aria Chen - Lost Love*

As you touch the names, they shimmer with possibility. A tarot deck falls from between the pages—79 cards, one extra. The Seeker.

You are now a Reader.

+ [Accept your calling] -> ReaderDesk

:: ReaderDesk ^UI:DASHBOARD
~ available_clients = ["Elena", "Marcus", "Aria"]

*Your sanctuary. Candles flicker. Cards wait.*

+ {"Elena" in available_clients} [Elena Hart] -> Elena_Session ^CLIENT ^var:elena
+ {"Marcus" in available_clients} [Marcus Webb] -> Marcus_Session ^CLIENT ^var:marcus
+ {"Aria" in available_clients} [Aria Chen] -> Aria_Session ^CLIENT ^var:aria
+ [Nyx] -> Nyx_Session ^CLIENT:SPECIAL ^var:nyx
+ [Review your progress] -> Progress ^META_OPTION
+ [Study the cards] -> StudyCards

:: Progress
**═══ YOUR JOURNEY ═══**

**Sessions:** {completed_sessions}
**Earnings:** ${total_earnings}
**Level:** {reader.get_level()} ({reader.experience} XP)

<<if reader.experience < 50>>
You are still a novice, learning to read the energy.
<<elif reader.experience < 150>>
Your intuition is developing. Clients begin to trust you.
<<elif reader.experience < 300>>
You are a seasoned reader. Your reputation grows.
<<else>>
You are a master. Clients seek you from far and wide.
<<endif>>

**Client Progress:**
- Elena: {completed_sessions >= 1 and "Completed" or "Available"}
- Marcus: {completed_sessions >= 2 and "Completed" or "Not yet available"}
- Aria: {completed_sessions >= 3 and "Completed" or "Not yet available"}

+ [Return to desk] -> ReaderDesk

:: StudyCards
You spread the cards across your desk. 79 cards shimmer in the candlelight.

The extra card—The Seeker—pulses with your energy. It represents the questioner, the one seeking truth.

Major Arcana: 22 cards of profound transformation
Minor Arcana: 56 cards of daily life
The Seeker: 1 wild card, unpredictable

+ [Return to desk] -> ReaderDesk

:: Elena_Session
<<py
# Create Elena client
client = Client("Elena Hart", 28)
client.trust_level = 35  # Nervous, skeptical

# Draw three cards for a past-present-future spread
cards = draw_cards()
positions = ["past", "present", "future"]
for i, card in enumerate(cards):
    card.in_position(positions[i])
>>
A young woman with anxious eyes enters. She fidgets with her bracelet.

"I've... I've never done this before. My friend recommended you. I don't know if I believe in this stuff, but..."

She trails off, looking at the cards.

**Client:** {client.name}
**Age:** {client.age}
**Current Trust:** {client.trust_level}/100

You shuffle the deck, feeling Elena's energy - doubt mixed with desperate hope.

+ [Draw the cards] -> Elena_Draw

:: Elena_Draw
**═══ THE SPREAD ═══**

You lay out three cards in a line:

**PAST:** {cards[0].get_display_name()}
**PRESENT:** {cards[1].get_display_name()}
**FUTURE:** {cards[2].get_display_name()}

<<if any(card.is_major_arcana() for card in cards)>>
Major arcana appears. This is significant.
Elena leans forward, her skepticism wavering.
<<endif>>

<<if sum(1 for c in cards if c.reversed) >= 2>>
Two reversed... blocked energy. Elena needs to hear this carefully.
<<endif>>

**═══ INTERPRETATIONS ═══**

How will you read for Elena?

+ [Traditional interpretation - Safe, by-the-book] -> Elena_Traditional
+ [Intuitive interpretation - Trust your gut] -> Elena_Intuitive
+ [Direct interpretation - Tell her what you really see] -> Elena_Direct

:: Elena_Traditional
<<py
reader.add_experience(10)
client.modify_trust(8)  # She appreciates the structure
completed_sessions += 1
total_earnings += 75
>>

You provide a careful, traditional interpretation:

"The {cards[0].name} in your past suggests {cards[0].position == 'past' and 'foundations' or 'challenges'}..."

Elena nods slowly. "That... that makes sense. My ex always said I didn't trust enough."

<<if cards[1].reversed>>
"The reversed {cards[1].name} in your present shows resistance to change."
<<else>>
"The {cards[1].name} in your present shows you're ready for transformation."
<<endif>>

She's listening now, really listening.

"And your future... the {cards[2].name}... this suggests {cards[2].reversed and 'caution is needed' or 'positive growth'}."

**Session Complete**

Elena's trust: {client.trust_level}/100
Your experience: +10 XP
Earnings: +$75

Elena stands, looking thoughtful. "Thank you. I... I think I needed to hear that."

+ [Return to desk] -> ReaderDesk

:: Elena_Intuitive
<<py
reader.add_experience(15)
client.modify_trust(12)  # She's moved by your insight
completed_sessions += 1
total_earnings += 75
>>

You close your eyes, letting intuition guide you:

"I see... walls. You've built them so high."

Elena's breath catches. Her eyes shimmer.

"The {cards[0].name} isn't just your past—it's a prison you've locked yourself in. You're afraid if you trust again, you'll shatter."

She looks away, but you see the tear.

<<if cards[1].reversed>>
"But here, now—the reversed {cards[1].name}—you're already breaking free. You're here, aren't you? That took courage."
<<else>>
"And here, the {cards[1].name} upright—you're ready. More ready than you think."
<<endif>>

"Your future... the {cards[2].name}... {cards[2].reversed and 'will challenge you, but you will rise' or 'shows love waiting, if you let it in'}."

**Session Complete**

Elena's trust: {client.trust_level}/100
Your experience: +15 XP
Earnings: +$75

Elena stands, wiping her eyes. "How did you...?" She doesn't finish. "Same time next week?"

+ [Return to desk] -> ReaderDesk

:: Elena_Direct
<<py
reader.add_experience(12)
client.modify_trust(15)  # Honesty resonates deeply
completed_sessions += 1
total_earnings += 75
>>

You don't soften it:

"You came here expecting me to tell you what you want to hear. I won't."

Elena stiffens, but doesn't leave.

"The {cards[0].name} in your past—you've been hurt. Badly. But you're using that hurt as an excuse."

<<if cards[1].reversed>>
"The reversed {cards[1].name} right now? That's not fate. That's you, choosing to stay stuck."
<<else>>
"The {cards[1].name} right now shows you KNOW this. You know you're ready."
<<endif>>

"And your future—the {cards[2].name}—{cards[2].reversed and 'will stay blocked until YOU unblock it' or 'is already opening up, if you have the courage to walk through that door'}."

**Session Complete**

Elena's trust: {client.trust_level}/100
Your experience: +12 XP
Earnings: +$75

Elena sits in silence for a long moment. Then she laughs—short, surprised. "You're right. Damn. Okay. Okay."

She leaves with purpose in her step.

+ [Return to desk] -> ReaderDesk

:: Marcus_Session
**Marcus Webb's session would go here...**

This is a placeholder for the next client.

+ [Return to desk] -> ReaderDesk

:: Aria_Session
**Aria Chen's session would go here...**

This is a placeholder for the next client.

+ [Return to desk] -> ReaderDesk

:: Nyx_Session
**Nyx's Special dream-session would go here...**

This is a placeholder for a **special client.**

+ [Return to desk] -> ReaderDesk